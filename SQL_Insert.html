<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	font-weight: bold;
	color: #FF8000;
}
.sc3 {
	color: #0080FF;
}
.sc12 {
	font-weight: bold;
	color: #8080FF;
}
.sc17 {
	color: #008000;
}
.sc19 {
	font-weight: bold;
	color: #000080;
}
.sc24 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2"># Inserção de Dados na Tabela FactSales
</span><span class="sc24">
</span><span class="sc2">## Descrição
</span><span class="sc0">Este</span><span class="sc24"> </span><span class="sc0">script</span><span class="sc24"> </span><span class="sc0">SQL</span><span class="sc24"> </span><span class="sc0">realiza</span><span class="sc24"> </span><span class="sc0">a</span><span class="sc24"> </span><span class="sc0">inserção</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">dados</span><span class="sc24"> </span><span class="sc0">na</span><span class="sc24"> </span><span class="sc0">tabela</span><span class="sc24"> </span><span class="sc17">`FactSales`</span><span class="sc24"> </span><span class="sc0">a</span><span class="sc24"> </span><span class="sc0">partir</span><span class="sc24"> </span><span class="sc0">dos</span><span class="sc24"> </span><span class="sc0">dados</span><span class="sc24"> </span><span class="sc0">da</span><span class="sc24"> </span><span class="sc0">tabela</span><span class="sc24"> </span><span class="sc17">`StageSales`</span><span class="sc0">.</span><span class="sc24"> </span><span class="sc0">Ele</span><span class="sc24"> </span><span class="sc0">mapeia</span><span class="sc24"> </span><span class="sc0">chaves</span><span class="sc24"> </span><span class="sc0">estrangeiras</span><span class="sc24"> </span><span class="sc0">para</span><span class="sc24"> </span><span class="sc0">chaves</span><span class="sc24"> </span><span class="sc0">primárias</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">tabelas</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">dimensão</span><span class="sc24"> </span><span class="sc0">correspondentes.</span><span class="sc24">

</span><span class="sc2">## Principais Comandos Utilizados
</span><span class="sc24">
</span><span class="sc3">1.</span><span class="sc24"> </span><span class="sc19">**INSERT INTO**</span><span class="sc12">:</span><span class="sc24"> </span><span class="sc0">Este</span><span class="sc24"> </span><span class="sc0">comando</span><span class="sc24"> </span><span class="sc0">é</span><span class="sc24"> </span><span class="sc0">usado</span><span class="sc24"> </span><span class="sc0">para</span><span class="sc24"> </span><span class="sc0">inserir</span><span class="sc24"> </span><span class="sc0">dados</span><span class="sc24"> </span><span class="sc0">em</span><span class="sc24"> </span><span class="sc0">uma</span><span class="sc24"> </span><span class="sc0">tabela.</span><span class="sc24">

</span><span class="sc3">2.</span><span class="sc24"> </span><span class="sc19">**SELECT**</span><span class="sc12">:</span><span class="sc24"> </span><span class="sc0">É</span><span class="sc24"> </span><span class="sc0">usado</span><span class="sc24"> </span><span class="sc0">para</span><span class="sc24"> </span><span class="sc0">recuperar</span><span class="sc24"> </span><span class="sc0">dados</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">uma</span><span class="sc24"> </span><span class="sc0">ou</span><span class="sc24"> </span><span class="sc0">mais</span><span class="sc24"> </span><span class="sc0">tabelas.</span><span class="sc24">

</span><span class="sc3">3.</span><span class="sc24"> </span><span class="sc19">**MAX()**</span><span class="sc12">:</span><span class="sc24"> </span><span class="sc0">Retorna</span><span class="sc24"> </span><span class="sc0">o</span><span class="sc24"> </span><span class="sc0">maior</span><span class="sc24"> </span><span class="sc0">valor</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">uma</span><span class="sc24"> </span><span class="sc0">coluna.</span><span class="sc24"> </span><span class="sc0">Neste</span><span class="sc24"> </span><span class="sc0">caso,</span><span class="sc24"> </span><span class="sc0">é</span><span class="sc24"> </span><span class="sc0">utilizado</span><span class="sc24"> </span><span class="sc0">para</span><span class="sc24"> </span><span class="sc0">obter</span><span class="sc24"> </span><span class="sc0">a</span><span class="sc24"> </span><span class="sc0">chave</span><span class="sc24"> </span><span class="sc0">primária</span><span class="sc24"> </span><span class="sc0">correspondente</span><span class="sc24"> </span><span class="sc0">com</span><span class="sc24"> </span><span class="sc0">base</span><span class="sc24"> </span><span class="sc0">em</span><span class="sc24"> </span><span class="sc0">valores</span><span class="sc24"> </span><span class="sc0">específicos</span><span class="sc24"> </span><span class="sc0">nas</span><span class="sc24"> </span><span class="sc0">tabelas</span><span class="sc24"> </span><span class="sc0">de</span><span class="sc24"> </span><span class="sc0">dimensão.</span><span class="sc24">

</span><span class="sc3">4.</span><span class="sc24"> </span><span class="sc19">**FROM**</span><span class="sc12">:</span><span class="sc24"> </span><span class="sc0">Especifica</span><span class="sc24"> </span><span class="sc0">a</span><span class="sc24"> </span><span class="sc0">tabela</span><span class="sc24"> </span><span class="sc0">da</span><span class="sc24"> </span><span class="sc0">qual</span><span class="sc24"> </span><span class="sc0">os</span><span class="sc24"> </span><span class="sc0">dados</span><span class="sc24"> </span><span class="sc0">devem</span><span class="sc24"> </span><span class="sc0">ser</span><span class="sc24"> </span><span class="sc0">recuperados.</span><span class="sc24">

</span><span class="sc2">## Script Anotado
</span><span class="sc24">
</span><span class="sc17">```sql
-- Inserção de Dados na Tabela FactSales

INSERT INTO dbo.FactSales
SELECT
    -- Mapeamento da chave de data
    (SELECT MAX(DateKey)
     FROM dbo.DimDate
     WHERE FullDateAlternateKey = stg.OrderDate) AS OrderDateKey,
    
    -- Mapeamento da chave do cliente
    (SELECT MAX(CustomerKey)
     FROM dbo.DimCustomer
     WHERE CustomerAlternateKey = stg.CustNo) AS CustomerKey,
    
    -- Mapeamento da chave do produto
    (SELECT MAX(ProductKey)
     FROM dbo.DimProduct
     WHERE ProductAlternateKey = stg.ProductID) AS ProductKey,
    
    -- Mapeamento da chave da loja
    (SELECT MAX(StoreKey)
     FROM dbo.DimStore
     WHERE StoreAlternateKey = stg.StoreID) AS StoreKey,
    
    -- Demais campos
    OrderNumber,
    OrderLineItem,
    OrderQuantity,
    UnitPrice,
    Discount,
    Tax,
    SalesAmount
FROM dbo.StageSales AS stg;
</span></div></body>
</html>
